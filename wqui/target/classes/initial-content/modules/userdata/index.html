<!DOCTYPE html>
<html>
	<head>
		<script>
			dojoConfig = {
				packages: [
					{
						name: "spolo",
						location: "/script/spolo"
					}
				]
			};
		</script> 
		<script type="text/javascript" src="/libs/dojo/dojo.js"></script>
		<script type="text/javascript" src="/system/sling.js"></script>
		<script type="text/javascript" src="/script/spolo.js"></script>
		<script type="text/javascript" src="/script/spolo/data/grant.js"></script>
		
		<script type="text/javascript" src="/libs/jquery/jquery.js"></script>
		<script type="text/javascript" src="/libs/bootstrap/js/bootstrap.min.js"></script>
		
		<link rel="stylesheet" href="/libs/bootstrap/css/bootstrap.min.css" media="screen">
		<link rel="stylesheet" href="/libs/bootstrap/css/bootstrap-responsive.min.css" media="screen">
	</head>
	<body>
		<div style="padding:50px;">
			
			<div class="navbar">
				<div class="navbar-inner">
					<div class="container" id="fsetup">
						<ul class="nav nav-tabs">
							<li class="">
								<a href="#">我的应用模块</a>
							</li>
							<li class=""><a href="#">我的收藏</a></li>
							<li class="active"><a href="#">我的账户设置</a></li>
							<li class=""><a href="#">我的消息</a></li>
						</ul>
					</div>
				</div>
			</div>
			<div class="hero-unit">
				<div class="navbar">
					<div class="container" id="setup">
						<p class="brand" style="font-size:30px;">账户设置</p>
						<ul class="nav nav-tabs">
							<li class="active" id="basicsetup"><a href="#">基本设置</a></li>
							<li><a>|</a></li>
							<li class=""><a href="#">常用设置</a></li>
							<li><a>|</a></li>
							<li class=""><a href="#">常用地址信息</a></li>
							<li><a>|</a></li>
							<li class="" id="boundphone"><a href="#">手机绑定</a></li>
							<li><a>|</a></li>
							<li class=""><a href="#">邮件订阅</a></li>
						</ul>
					</div>
					<div style="margin-left:200px;"id="userbs">
						<form class="navbar-form" autocomplete="on" method="post" name="myForm">
							
							<div class="container">
								<span class="brand">用户名：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
									<span id="username" class="brand"> </span>
							</div>
							<div class="container">
								<span class="brand">重置密码：</span>
							
									<input type="password" class="span2" name="nickname" id="resetpw" value="">
									<span id="nicktishi" style="display:none;">可以输入4-20位。包含数字、英文</span>
							</div>
							<div class="container">
								<span class="brand">确认密码：</span>
							
									<input type="password" class="span2" name="area" id="confirmpw">
									<span id="areatishi" style="display:none;">可以输入4-20位。包含数字、英文</span>
							</div>
							<div class="btn-group">
								<input type="button" class="btn" value="确认" style="margin-left: 125px" id="btn">
							</div>
						</form>
					</div>
					<div style="display:none;" id="dphone">
						<form class="navbar-form" autocomplete="on" method="post">
							<div class="container">
								<span class="brand">手机号：</span>
									<input type="text" class="span2" placeholder="请输入手机号码">
									<input type="button" class="btn" value="发送验证码" id="verificationcode">
							</div>			
							<div class="container">
								<span class="brand">验证码：</span>
								<input type="password" class="span2" placeholder="手机获得的验证码">	
							</div>
							<div class="btn-group">
								<input type="button" class="btn" value="确认" style="margin-left: 100px" id="phonebtn">
							</div>
						</form>
					</div>
				</div>
				
			</div>
			
		</div>
	</body>
	<script>
		require(["dojo/ready","dojo/on","spolo/data/grant"],function(ready,on,grant){
		ready(function(){
			//获得当前用户
			var user = Spolo.getUserId();
			console.log(user);
			$("#username").html(Spolo.decodeUname(user));
			var duser = Spolo.decodeUname(user);
			
			//实例化group对象
			var grant_class = new grant();
			
			//设置users权限
			
			// input框获取焦点
			$("#btn").click(function(){		
				//allFocus();
				btnCheckForm();
				var resetPw = $("#resetpw").val();
				var confirmPw = $("#confirmpw").val();
				var args = {
					"userName" : duser,
					"newPwd" :resetPw ,
					"newPwdConfirm" :confirmPw,
					"success" :function(data){
						console.log("changePwd success");
						console.log(data);
					},
					"failed" : function(error){
						console.log("changePwd failed");
						console.log(error);
					}
				};
				console.log(args);
				if(resetPw!=confirmPw){
					alert("两次输入不一致，请重新输入");
					$("#resetpw").val("");
					$("#confirmpw").val(""); 
					$("#resetpw").focus();
				}else{
					grant_class.changePwd(args);
				}
			});

			$("#resetpw").focus(function(){
				nicknameFocus();
			});
			
			$("#confirmpw").focus(function(){
				 areaFocus();
			});
			//显示不同的div
			$("#boundphone").click(function(){
				$("#userbs").attr("style","display:none");
				$("#dphone").attr("style","display:block;margin-left:200px;");
			});

			$("#basicsetup").click(function(){
				$("#dphone").attr("style","display:none");
				$("#userbs").attr("style","display:block;margin-left:200px;");
			});
			// 点击li标签更换样式
			require(["dojo/query","dojox/NodeList/delegate"],function(query,delegate)
			{
				query("#setup").delegate("li","click",function(evt)
				{
					changeStyle.call(this);		
				});
				
				query("#fsetup").delegate("li","click",function(evt)
				{
					changeStyle.call(this);	
				});
				
			});

		});
		
			function btnCheckForm(){
				var myForm = document.myForm;
				var $tishi = $("#tishi");
				if(myForm.nickname.value == ""|| myForm.area.value == ""){
					alert("请完成表单");
					if(myForm.nickname.value ==""){
						myForm.nickname.focus();
					}else{
						myForm.area.focus();
					}
				}
				else{
					alert("感谢完成基本信息");
				}
			}
			
			
			function nicknameFocus(){
				$("#nicktishi").attr("style","display:inline;font-size:10px");
				$("#areatishi").attr("style","display:none");
			}
		
			function nicknameBlur(){
				var nickname = document.myForm.nickname;
				if(nickname.value == ""){
					alert("请输入一个有效的密码");
					nickname.focus();
					nickname.select();
				}
			}
			
			function areaFocus(){
				$("#areatishi").attr("style","display:inline;font-size:10px");
				$("#nicktishi").attr("style","display:none");
				$("#tishi").attr("style","display:none");
			}
			
			function areaBlur(){
				var area = document.myForm.area;
				if(area.value == ""){
					alert("请输入一个有效的地址");
					area.focus();
					area.select();
				}
			}
			
			function allFocus(){
				$("#areatishi").attr("style","display:none");
				$("#nicktishi").attr("style","display:none");
			}
			
			
			//改变li的class属性
			function changeStyle(li)
			{
				var _this = this;
				require(["dojo/query","dojo/dom-attr","dojo/dom-class","dojo/NodeList-traverse"],function(query,domAttr,domClass)
				{
					domAttr.set(_this,"class","active");
					var sib = query(_this).siblings();
					for(var i = 0;i < sib.length;i++)
					{
						if(domClass.contains(sib[i],"active"))
						{
							domClass.remove(sib[i],"active");
						}
					}
				});
			}
			
				
			//检查用户操作过程中的登录状态
			function isLogin(){
				if(Spolo.getUserId() == "anonymous"){
					Spolo.notify({
						"text" : "操作失败，您已处于下线状态，请重新登录！",
						"type" : "warning",
						"timeout" : 1000
					});
					window.location.href = "/modules/user/index.html";
					return false;
				}else{
					return true;
				}
			}
		
	})
	</script>
	
</html>