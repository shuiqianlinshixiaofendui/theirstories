/** *  This file is part of the spp(Superpolo Platform). *  Copyright (C) by SanPolo Co.Ltd. *  All rights reserved. * *  See http://www.spolo.org/ for more information. * *  SanPolo Co.Ltd *  http://www.spolo.org/ *  Any copyright issues, please contact: copr@spolo.org**//**	摄像机子模块	负责处理摄像机事件：	* 转换视角*/define("web3d/operate/operate_changeView",["dojo/topic"],function(topic){	var viewpoint;	var viewarea;		function getTarg(axisAngle){		var current_mat = x3dom.fields.Quaternion.parseAxisAngle(axisAngle).toMatrix();				var sync = Spolo.dataSync;		var data = sync.get_camera_data();		data.current_rotmat = current_mat;		sync.update_camera_data(data);				current_mat.setTranslate(new x3dom.fields.SFVec3f(0,0,-10));		return current_mat;	}		function run(targ){		viewarea.animateTo(targ, viewpoint);		topic.publish("command/viewpoint_action/fixedViewMove");	}		var operate_changeView = dojo.declare([],{				constructor : function(x3d){			this.cameraPosInitHandle = topic.publish("cameraPos/init"); // 此处调用了别的模块，按我们当前的思路这里走不通			viewarea = x3d.runtime.canvas.doc._viewarea;			viewpoint = viewarea._scene.getViewpoint();			Spolo.aroundObjOperationMode = false;		},				// 响应视角转为自由视角操作		toFreeView : function(){			var targ = getTarg("0 1 0 0");			Spolo.current_view = Spolo.view_list[0];			viewarea.animateTo(targ, viewpoint);			topic.publish("command/viewpoint_action/translate");		},				// 响应视角转为前视角操作		toFrontView : function(){			var targ = getTarg("0 1 0 0");			Spolo.current_view = Spolo.view_list[1];			run(targ);		},				// 响应视角转为后视角操作		toBackView : function(){			var targ = getTarg("0 1 0 "+Math.PI);			Spolo.current_view = Spolo.view_list[2];			run(targ);		},				// 响应视角转为左视角操作		toLeftView : function(){			var targ = getTarg("0 1 0 "+Math.PI/2);			Spolo.current_view = Spolo.view_list[3];			run(targ);		},				// 响应视角转为右视角操作		toRightView : function(){			var targ = getTarg("0 1 0 "+(-Math.PI/2));			Spolo.current_view = Spolo.view_list[4];			run(targ);		},				// 响应视角转为上视角操作		toTopView : function(){			var targ = getTarg("1 0 0 "+Math.PI/2);			Spolo.current_view = Spolo.view_list[5];			run(targ);		},				// 响应视角转为下视角操作		toBottomView : function(){			var targ = getTarg("1 0 0 "+(-Math.PI/2));			Spolo.current_view = Spolo.view_list[6];			run(targ);		},				// 删除node		unload : function(){			if(this.cameraPosInitHandle){				this.cameraPosInitHandle.remove();			}		}			});			return operate_changeView;});