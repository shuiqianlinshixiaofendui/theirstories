<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>
            上传模型
        </title>

		<script type="text/javascript" >
			dojoConfig = {
				//parseOnLoad: true, 
				packages: [
					{
						name: "spolo",
						location: "/script/spolo"
					},
					{
						name: "scenedetail",
						location: "/modules/scenedetail"
					},
					{
						name: "widgets",
						location: "/widgets"
					}
				]
			};
		</script>
		
        <script type="text/javascript" src="/libs/dojo/dojo.js"></script>
		<script type="text/javascript" src="/system/sling.js"></script>
		<script type="text/javascript" src="/script/spolo.js"></script>
        <script type="text/javascript" src="/libs/dijit/dijit.js"></script>
		<script type="text/javascript" src="/libs/sling/explorer/js/jquery-1.4.2.min.js"></script>
		<link rel="stylesheet" href="/libs/dijit/themes/claro/claro.css"  media="screen"/>
		<link rel="stylesheet" href="css/uploadmodel.css" media="screen" />
		<link rel="stylesheet" href="/widgets/Mask/css/main.css" media="screen">
    </head>
    
    <body class="claro">
		<div id="uploadmodelBorderContainer" dojoType="dijit.layout.BorderContainer" >
			<div id="uploadmodelfirst" dojoType="dijit.layout.ContentPane" region="top" class="uploadmodelContent">
				首先，需要输入上传的份数：
				<!-- <br /><br /> -->
				<span class="upload">上传</span>
				<input id="uploadValue" promptMessage="上传份数" class="inputBox" data-dojo-type="dijit.form.ValidationTextBox" trim="true" value="1" size="6"/>
				<span class="num">份</span>
			</div>
			<div id="uploadmodel" dojoType="dijit.layout.ContentPane" region="center" class="uploadmodelContent">
				其次，选择将要上传的文件：
				<br /><br />
				<form id="upload_form" method="POST" enctype="multipart/form-data">
					<input name="选择文件" id="uploadFile" type="file"><br /><br /><br />
				</form>
			</div>
			<div id="uploadmodellast" dojoType="dijit.layout.ContentPane" region="bottom" class="uploadmodelContent">
				最后，点击此按钮进行上传：
				<!-- <br/><br/> -->
				<input type="button" id="btnuploadSure" value="确定">

			</div>
		</div>
	<script type="text/javascript">
		require(
			[
				"dojo/parser","dojo/ready","dojo/dom","dojo/dom-style", "dojo/query", "dojo/on","spolo/data/scene","widgets/Mask/Mask"
				
			],function(
				parser, ready, dom, domStyle,query,on,scene_cls,Mask
			){
				ready(function(){
					var scene = this.parent.scene;
					var iframe = this.parent.iframe;
					on(dom.byId("btnuploadSure"),"click",function(){
						if(dom.byId("uploadFile").value == "")
						{
							Spolo.notify({
								text : "请选择文件!!",
								type : "error",
								timeout : 1000
							});
						}
						else
						{
							var value = dom.byId("uploadValue").value;
							if(isNaN(value))
							{
								Spolo.notify({
									text : "您的输入有误!!",
									type : "error",
									timeout : 1000
								});
							}
							else
							{
								var path = scene.getURI();						
								var newScene = new scene_cls(path);
								Mask.show();
								newScene.addExternalmodelByzip("upload_form",
								{
									 num : value,
									resumable : true,
									notifier : function(msg)
									{
										console.log(msg);
									},
									load : function(data)
									{
										if(data.suc)
										{
											iframe.refreshEditItems();
											Mask.hide();
											Spolo.notify({
												text : "上传模型成功!!",
												type : "success",
												timeout : 1000
											});
										}
										else
										{
											Spolo.notify({
												text : "上传模型失败!!",
												type : "error",
												timeout : 1000
											});
										}
									},
									error : function(err)
									{
										Spolo.notify({
											text : "上传模型失败!!",
											type : "error",
											timeout : 1000
										});
									}
								});
							}
						}
					});
				});
			}
		);
	</script>	
    </body>
</html>