<!DOCTYPE HTML>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Glue</title>
		<script>
			dojoConfig = {
				packages: [
				    {
						name: "spolo",
						location: "/script/spolo"
					},
					{
						name: "modulemanager",
						location: "/modules/modulemanager"
					},
					{
						name: "widgets",
						location: "/widgets"
					}
				],
			};
			
			
		</script>
		<script type="text/javascript" src="/libs/dojo/dojo.js"></script>
		<script type="text/javascript" src="/system/sling.js"></script>
		<script type="text/javascript" src="/script/spolo.js"></script>
		<link rel="stylesheet" href="/libs/dijit/themes/claro/claro.css" media="screen">
		<link rel="stylesheet" href="/modules/modulemanager/css/main.css" media="screen">
		<link rel="stylesheet" href="/widgets/Mask/css/main.css" media="screen">

		<!--lib-->
		<script type="text/javascript" src="/libs/sling/explorer/js/jquery-1.4.2.min.js"></script>
		<script type="text/javascript" src="/script/spolo/ui/noty/jquery-1.7.2.min.js"></script>
		<script type="text/javascript" src="/libs/jquery/jquery-ui.js"></script>
		<link rel="stylesheet" href="/libs/jquery/jquery-ui.css" media="screen">

		<!-- noty -->
		<script type="text/javascript" src="/script/spolo/ui/noty/jquery.noty.js"></script>

		<!-- layouts -->
		<script type="text/javascript" src="/script/spolo/ui/noty/layouts/topCenter.js"></script>

		<!-- themes -->
		<script type="text/javascript" src="/script/spolo/ui/noty/themes/default.js"></script>

		
		
		
		<script>
			// 判断用户是否登录
			// 如果没有登录直接跳到登录页面
			var session = Sling.getSessionInfo();
			var userid, 
				href = "/modules/user/index.html";
			if(session){
				userid = session["userID"];
				if(userid=="anonymous"){
					window.location.href = href;
				}
			}
			
			
		    // 引入spolo.data.user
			dojo.require("spolo.data.user");
			var path = "/content/users/"+Spolo.getUserId();
			var user = spolo.data.user.getInstance(path);
			// var user2 = spolo.data.user.getInstance(path);
			Spolo.currentUser = spolo.data.user;
			// 引入spolo.data.modules
			dojo.require("spolo.data.modules");
			var modules = spolo.data.modules.getInstance("/modules");
			// var modules2 = spolo.data.modules.getInstance("/modules");
			Spolo.modules = spolo.data.modules;
			
			// 标志此为根节点
			Spolo.isRoot = true;
		</script>
		
	</head>
	<body class="claro">
		<div id="_sp_main_container" dojoType="dijit.layout.BorderContainer" 
			design="sidebar" gutters=false>
			<div id="_sp_mainframe_content" dojoType="dijit.layout.ContentPane" 
											region="center">
				<iframe id="_sp_mainframe_iframe" src=""></iframe>
			</div>
		</div>
		
		<!-- 引入窗口组件 -->
		<script type="text/javascript" src="/script/spolo/ui/spdialog.js"></script>
		<script>
			//这儿临时将遮罩方法写到这里，以后移动到/spolo/ui/spdialog中
			var spshowmask = function()
			{
				require(["widgets/Mask/Mask"], function(Mask)
				{
					Mask.show();
				});
			}
			var sphidemask = function()
			{
				require(["widgets/Mask/Mask"], function(Mask)
				{
					Mask.hide();
				});
			}
			require(["dojo/parser", "dojo/ready", "dijit/layout/BorderContainer", "dijit/layout/ContentPane"], function(parser, ready){
				ready(function(){
					// 把 dojo widget 展开为 HTML DOM
					parser.parse();
					
					// 加载节点
					require([
						"modulemanager/node/navigator",
						"modulemanager/action/navAction"
					],function(navigator, navAction){
						var nav = new navigator("_sp_main_container");
					});
				});
			});
		</script>
	</body>
</html>
