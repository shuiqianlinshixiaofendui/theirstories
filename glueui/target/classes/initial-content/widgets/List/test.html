<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8">
		<title>Glue</title>
		
		<script type="text/javascript">
			var dojoConfig = {
				parseOnLoad: true, 
				packages:[
					{
						name: "widgets",
						location: "/widgets"
					},
					{
						name:"spolo",
						location:"/script/spolo"
					}
					
				]
			};
		</script>
		<script type="text/javascript" src="/libs/dojo/dojo.js"></script>
		<script type="text/javascript" src="/libs/dijit/dijit.js"></script>
		<script type="text/javascript" src="/libs/sling/explorer/js/jquery-1.4.2.min.js"></script>
		<link rel="stylesheet" href="/libs/dijit/themes/claro/claro.css" media="screen">
		<link rel="stylesheet" href="css/main.css" media="screen">
		<style type="text/css">
			html,body{
				height:100%;
			}
			#testContainer{
				width: 100%; 
				float:left;
				border:1px solid #d1d1d1;
			}
			.btnGroup{
				float:left;
				margin-top:5px;
				margin-bottom:5px;
			}
			.selectBtn,.listType,.editBtn,.selectModel{
				float:left;
				margin-left:20px;
				display:inline;
				color:#fff;
				padding:10px;
				font-weight:bold;
				background:#5080d8;
				cursor:pointer;
				z-index:1;
				-webkit-border-radius: 4px;
				-moz-border-radius: 4px;
				border-radius: 4px;
			}
		</style>
	</head>
	
	<body class="claro">
		<div class="btnGroup">
			<div class="selectBtn">全选</div>
			<div class="listType">列表</div>
			<div class="editBtn">编辑模式</div>
			<div class="selectModel">选择模式</div>
		</div>
		<div id="testContainer"></div>
		
		<script>
			require(
				[
					"widgets/List/List",
					"dojo/on",
					"dijit/Dialog",
					"spolo/data/spsession"
				],
				function
				(
				List, on, Dialog,spsession
				)
				{	var config = {
						//isRadio:true //是否打开单选模式。默认为多选。单选模式下禁止全选与取消功能。
					}
					//创建List widget对象
					var list = new List(config);

					//组装list组件
					list.placeAt("testContainer");
					
					/**
					*测试用按钮事件
					*/
					//全选/取消按钮切换事件
					$(".selectBtn").toggle(function(){
						if(list.isRadio){
							Spolo.notify({
								"text" : "单选模式下不支持该功能！",
								"type" : "error",
								"timeout" : 1000
							});
						}else{
							list.selectAll();
							$(this).text("取消");
						}
					},function(){
						if(list.isRadio){
							Spolo.notify({
								"text" : "单选模式下不支持该功能！",
								"type" : "error",
								"timeout" : 1000
							});
						}else{
							list.unSelectAll();
							$(this).text("全选");
						}
					});
					
					//缩略图/列表按钮切换事件
					$(".listType").toggle(function(){
						list.showList();
						$(this).text("缩略图");
					},function(){
						list.showThumbnail();
						$(this).text("列表");
					});
					//启动/关闭选择模式
					$(".selectModel",this.buttonListNode).live("click",function(){
						$(this).toggle(function(){
							list.openSelect();
							$(this).text("关闭选择模式");
						},function(){
							list.closeSelect();
							$(this).text("选择模式");
						}).trigger("click");
					});
					//编辑/结束编辑按钮切换事件
					$(".editBtn").toggle(function(){
						list.openEdit();
						$(this).text("关闭编辑模式");
					},function(){
						list.closeEdit();
						$(this).text("编辑模式");
					});
					
					//测试响应点击图片接收事件
					on(list,"onListItemClick",function(nodeData){
						//当前的节点数据
						console.log(nodeData);
					});

					//测试响应选择按钮状态改变事件
					on(list,"onItemStatuChanger",function(nodeData){
						//当前的节点数据
						console.log(nodeData);
					});
					
					var json = {
						totalNum:1,
						data:{
							"model20131211543204496446810":{
								"resourceName":"shafa1_1",
								"sling:resourceType":"model",
								"jcr:createdBy":"admin",
								"jcr:created":"2013-02-21T15:43:09.741+08:00",
								"jcr:primaryType":"sling:Folder"
							},
							"model20131211543204496446809":{
								"resourceName":"shafa1_2",
								"sling:resourceType":"model",
								"jcr:createdBy":"admin",
								"jcr:created":"2013-02-21T15:43:09.741+08:00",
								"jcr:primaryType":"sling:Folder"
							}
						}
					}
					
					/**
					*测试相关API方法
					*/
					var temp = new Array();
					for(var i in json["data"]){
						temp.push(i);
					}
					//加载List组件结构
					//list.addItems(temp,true);  第二个参数true代表是否清空列表，默认不清空。
					list.addItems(temp); 
					
					// 加载缩略图
					var itemId = "model20131211543204496446810";
					var url = "/widgets/List/images/nopreview.jpg";
					// 方法一（该方法后续将被废弃）
					list.setItemImageByKey(itemId,url);
					// 方法二（请使用下面的方法）
					list.setItemImage(itemId,url);
					
					// 添加dom节点
					var textNode = document.createTextNode("测试用文字");
					var domNode = document.createElement("Div");
					domNode.appendChild(textNode);
					// 该方法的domNode参数为domNode对象，也可以是字符串形式的dom节点（如：<button type="bottom" />）
					list.addDomNode(itemId,domNode);
					list.addDomNode(itemId,"2");
					list.addDomNode(itemId,"3");
					
					// 添加字段
					var jsons = {
						nodeType : "div", className : "test", content : "<img src='images/abc.jpg'/>", style : {"width":"120px","height":"99px","position":"absolute","left":"100px","top":"10px"}
					};
					list.addField(itemId,jsons);
					list.addField("model20131211543204496446809",jsons);
					
					//获取字段，4表示第4个字段
					var field = list.getField(itemId,4);
					
					//对获取的字段做修改
					//list.setField(field,"呵呵");
					
					//对获取的字段执行删除
					//list.delField(field);
					
					//删除列表项
					on(list,"onDelItemClick",function(itemId){
						list.delItem(itemId);
					});
					
					//获取所有的已选中项的itemid，格式是数组
					var array = list.getSelectNodes();
					
					//选中列表中item为itemid的元素，参数是数组
					list.selectByItemId([itemId])
					
					// 获取list中当前显示的itemid
					console.log(list.getCurrentItemIds());
				});
		</script>
	</body>
</html>