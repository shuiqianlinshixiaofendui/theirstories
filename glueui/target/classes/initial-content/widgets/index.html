<!DOCTYPE html >
<html>
	<head>
		<meta http-equiv="X-UA-Compatible" content="chrome=1" /> 
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8" /> 
		<title>Widget List</title>
		<link rel="stylesheet" href="/libs/dijit/themes/claro/claro.css" media="screen">
		<script type="text/javascript" src="/libs/dojo/dojo.js"></script>
		<style type="text/css">
			html, body {
				width:100%;
				height:100%;
				font-size:12px;
			}
			.memberItem{
				width:150px;
				height:16px;
				padding:5px 10px;
				border-bottom:1px solid #fff;
				cursor:pointer;
				margin-top:5px;
			}
		</style>
	</head>
	
	<body class="claro">
		
		<div dojoType="dijit.layout.BorderContainer" style="width:100%;height:100%;">
			<!-- 左侧 -->
			<div id="layout_left" style="width:200px;" dojoType="dijit.layout.ContentPane" data-dojo-props="region: 'left'">
				<div dojoType="dijit.layout.BorderContainer" style="width:100%;height:100%; padding:0px;" data-dojo-props="gutters:false">
					<div id="layout_left_center" dojoType="dijit.layout.ContentPane" data-dojo-props="region: 'center'" style="padding:0px;">
						<!-- 这里显示Widgets成员列表 -->
					</div>
				</div>
			</div>
			
			<!--  中间  -->
			<div id="layout_center" dojoType="dijit.layout.ContentPane" data-dojo-props="region:'center'" style="padding:0px; border:none;" >
				<div dojoType="dijit.layout.BorderContainer" style="width:100%;height:100%; padding:0px;" data-dojo-props="gutters:true">
					<div id="layout_center_top" style="height:50px;padding:0px;text-align:center;" dojoType="dijit.layout.ContentPane" data-dojo-props="region: 'top'">
					</div>
					<div id="layout_center_center" dojoType="dijit.layout.ContentPane" data-dojo-props="region: 'center'" style="padding:0px;overflow:hidden;">
						<!-- 内容区域 -->
						<iframe id="layout_center_iframe" src="" style="width:100%;height:100%;border:none;"></iframe>
					</div>
				</div>
			</div>
		</div>

		<script>
			window.widgets = {
				trachost:"http://devvm.spolo.org/"
			};
			
			require(["dojo/parser", "dojo/ready",
				"dijit/layout/BorderContainer",
				"dijit/layout/ContentPane",
				"dijit/form/Button",
				"dijit/form/TextBox"
			], function(parser,ready){
				ready(function(){
					parser.parse();
					var member = [
						{"widgetName":"AdvCategory"},
						{"widgetName":"Button"},
						{"widgetName":"Cart"},
						{"widgetName":"Dialog"},
						{"widgetName":"menu/ThirdNav"},
						{"widgetName":"PulldownMenu"},
						{"widgetName":"Search"},
						{"widgetName":"WaterFall"}
					];
					init(member);
				});
			});
			
			function init(member){
				require(["dojo/dom", "dojo/dom-construct","dojo/on"],function(dom, domConstruct, on){
					if(member && member.length){
						var container = dom.byId("layout_left_center");
						var layout_center_top = dom.byId("layout_center_top");
						var stringName = "Wdiget 总数为：" + member.length + "个";
						var iframe = document.getElementById("layout_center_iframe");
						iframe.src = widgets.trachost + "widgets/" + member[0]["widgetName"] + "/demo/index.html";
						domConstruct.create(
							"a",
							{
								innerHTML : stringName
							},
							layout_center_top
						);
						for(var i = 0; i < member.length; i ++){
							addMemberDom(member[i], container);
						}
					}
				});
			}
			
			function addMemberDom(memberItem, container){
				if(!memberItem){
					console.error("memberItem is undefined");
					return;
				}
				var dir = memberItem["widgetName"];
				if(!dir){
					console.error("memberItem[\"widgetName\"] is undefined");
					return;
				}
				if(!container){
					console.error("container is undefined!");
					return;
				}
				require(["dojo/dom-construct","dojo/on"], function(domConstruct, on){
					var div = domConstruct.create(
						"div",
						{
							className : "memberItem",
							dir : dir
						},
						container
					);
					var timelineIcon = domConstruct.create(
						"a",
						{
							innerHTML : dir,
							style: "margin-left:10px;",
							title : dir
						},
						div
					);
					
					on(div, "click", function(){
						if(window.widgets && window.widgets.selectMemberItem){
							window.widgets.selectMemberItem.style.fontWeight = "normal";
							window.widgets.selectMemberItem.style.fontSize = "12px";
						}else{
							window.widgets.selectMemberItem = this;
						}
						window.widgets.selectMemberItem = this;
						window.widgets.selectMemberItem.style.fontWeight = "bold";
						window.widgets.selectMemberItem.style.fontSize = "14px";
					});
					on(timelineIcon, "click", function(){
						itemClick(this.title);
					});
					on(div, "mouseover", function(){
						this.style.borderColor = "#069";
					});
					on(div, "mouseout", function(){
						this.style.borderColor = "#fff";
					});
				});
			}
			
			function itemClick(name){
				require(["dojo/dom"],function(dom){
					console.log("timelineIconClick click:" + name);
					var url = getTimelineUrl({
						widgetName : name
					});
					var iframe = window.widgets.iframe;
					if(!iframe){
						iframe = document.getElementById("layout_center_iframe");
						window.widgets.iframe = iframe;
					}
					iframe.src = url;
				});
			}
			
			function getTimelineUrl(args){
				var widgetName = args["widgetName"];
				if(!widgetName){
					widgetName = "";
				}
				var url = "";
				url += "widgets/" + widgetName + "/demo/index.html";
				return widgets.trachost + url;
			}
		</script>
	</body>
</html>