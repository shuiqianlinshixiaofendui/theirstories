<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>批量修改模型属性</title>
		<script type="text/javascript" >
			dojoConfig = {
				//parseOnLoad: true, 
				packages: [
					{
						name: "spolo",
						location: "/script/spolo"
					},
					{
						name: "scenedetail",
						location: "/modules/scenedetail"
					},
					{
						name: "widgets",
						location: "/widgets"
					}
				]
			};
		</script>
		<script type="text/javascript" src="/libs/dojo/dojo.js"></script>
		<link rel="stylesheet" href="/libs/dijit/themes/claro/claro.css" media="screen">
		<link rel="stylesheet" href="/widgets/Category/css/main.css" media="screen" />
		<link rel="stylesheet" href="/widgets/CategorySelect/css/main.css" media="screen" />
		<style type="text/css">
			html,body{
				font-size: 12px;
				width: 100%;
				height: 100%;
				margin: 0;
			}
		</style>
	</head>

    <body class="claro">
		<div data-dojo-type="dijit/layout/BorderContainer" style="width:100%;height:35%;">
			<div data-dojo-type="dijit/layout/ContentPane" style="height:35%;text-align:center;">
				<label style="float:left;width:10%;height:35%;font-size:150%;font-weight:bolder;">风格：</label>
				<button data-dojo-type="dijit/form/Button"
						id="_style_edit"
						style="float:left;width:auto;height:35%;">请选择风格</button>
			</div>
			<div data-dojo-type="dijit/layout/ContentPane" style="height:35%;text-align:center;">
				<label style="float:left;width:10%;height:35%;font-size:150%;font-weight:bolder;">主材：</label>
				<button data-dojo-type="dijit/form/Button"
						id="_madeOf_edit"
						style="float:left;width:auto;height:35%;">请选择主材</button>
			</div>
			<div data-dojo-type="dijit/layout/ContentPane" style="height:35%;text-align:center;">
				<label style="float:left;width:10%;height:35%;font-size:150%;font-weight:bolder;">分类：</label>
				<button data-dojo-type="dijit/form/Button"
						id="_category_edit"
						style="float:left;width:auto;height:35%;">请选择分类</button>
			</div>
			<div data-dojo-type="dijit/layout/ContentPane" style="height:35%;text-align:center;">
				<label style="float:left;width:10%;height:35%;font-size:150%;font-weight:bolder;">品牌：</label>
				<button data-dojo-type="dijit/form/Button"
						id="_category_edit"
						style="float:left;width:auto;height:35%;">请选择品牌</button>
			</div>
			<div data-dojo-type="dijit/layout/ContentPane" style="height:35%;text-align:center;">
				<label style="float:left;width:10%;height:35%;font-size:150%;font-weight:bolder;">居室类型：</label>
				<button data-dojo-type="dijit/form/Button"
						id="_room_edit"
						style="float:left;width:auto;height:35%;">请选择居室类型</button>
			</div>
			<div data-dojo-type="dijit/layout/ContentPane" style="height:35%;text-align:center;">
				<label style="float:left;width:10%;height:35%;font-size:150%;font-weight:bolder;">视觉感受：</label>
				<button data-dojo-type="dijit/form/Button"
						id="_sightfeeling_edit"
						style="float:left;width:auto;height:35%;">请选择视觉感受</button>
			</div>
			<div data-dojo-type="dijit/layout/ContentPane" style="height:35%;text-align:center;">
				<button data-dojo-type="dijit/form/Button"
						id="_save_btn_container"
						style="float:left;width:auto;height:35%;">保  存</button>
				<button data-dojo-type="dijit/form/Button"
						id="_back_btn_container"
						style="float:left;width:auto;height:35%;">取  消</button>
			</div>
		</div>
		<script type="text/javascript">
			require(
				[
					"dojo/on",
					"dojo/query",
					"widgets/Category/Category",
					"widgets/CategorySelect/CategorySelect",
					"dijit/Dialog",
					"dijit/form/Button",
					"dojo/dom",
					"dojo/_base/array",
					"dijit/layout/BorderContainer",
					"dijit/layout/ContentPane",
					"dijit/layout/TabContainer",
					"dijit/layout/AccordionContainer",
					"dijit/layout/AccordionPane"
				],function(
					on, query, Category, CategorySelect, Dialog, Button, dom, arrayUtil, BorderContainer, ContentPane
				){
					function newCategoryDialogAndShow(json)
					{
						// 1.new dialog
						// 2.new Category/CategorySelect
						// 3.Category/CategorySelect in dialog
						// 4.destroy
						var dthis = this;
						var dialogContent = "<div id=\"dialogCont\" style=\"margin:0px auto;\"></div>"+
										"<div style='margin:30px 0px 0px 100px;'>"+
											"<button type='button' id='modelEditSureBtn'></button>"+
											"<button type='button' id='modelEditCancelBtn'></button>"+
										"</div>";
						var dialog = new Dialog({
							title: json["title"],
							style: "width:90%;height:90%;background:#fff",
							content: dialogContent
						});
						var cateWidget = new Category(json).placeAt("dialogCont");
						var object = dom.byId(dthis.id);
						if(object.path && object.path != "undefined"){
							
							var selectedJson = {
								path : object.path,
								text : object.innerText,
								type : "modellibcategory"
							};
							console.log(selectedJson)
							cateWidget.initialize(selectedJson);
						}else{
							cateWidget.initialize();
						}
						var cancelBtn = new Button({
							label:" 取消 ",
							onClick:function(){
								closeDialog();
							}
						},"modelEditCancelBtn");
						var sureBtn = new Button({
							label:" 确定 ",
							onClick:function(){
								console.log(selectedData)
								var label = json["title"];
								if(selectedData["label"])
								{
									label = selectedData["label"];
								}
								var path = "";
								if(selectedData["path"])
								{
									path = selectedData["path"];
								}
								switch(json["property"])
								{
									case "madeOfPath":
										properties["madeOfPath"] = path;
										break;
									case "categoryPath":
										properties["categoryPath"] = path;
										break;
									case "brandPath":
										properties["brandPath"] = path;
										break;
								}
								object.innerText = label;
								object.path = path;
								closeDialog();
							}
						},"modelEditSureBtn");
						
						dialog.on("hide",function(){
							closeDialog();
						});
						
						function closeDialog(){
							cancelBtn.destroy();
							sureBtn.destroy();
							cateWidget.destroy();
							dialog.destroy();
						}
						var selectedData = {};
						on(cateWidget, "onSelectedListChanged", function(res){
							selectedData = res;
						});
						dialog.show();
					}
					
					function newCategorySelectDialogAndShow(json)
					{
						// 1.new dialog
						// 2.new Category/CategorySelect
						// 3.Category/CategorySelect in dialog
						// 4.destroy
						var dthis = this;
						var dialogContent = "<div id=\"dialogCont\" style=\"margin:0px auto;\"></div>"+
							"<div style='margin:30px 0px 0px 100px;'>"+
								"<button type='button' id='modelEditSureBtn'></button>"+
								"<button type='button' id='modelEditCancelBtn'></button>"+
							"</div>";
						var dialog = new Dialog({
							title: json["title"],
							style: "width:90%;height:90%;background:#fff",
							content: dialogContent
						});
						var cateWidget = new CategorySelect(json).placeAt("dialogCont");
						var object = dom.byId(dthis.id);
						console.log(object.path);
						if(object.path && object.path != "undefined"){
							
							var selectedJson = {
								path : object.path
							};
							console.log(selectedJson)
							cateWidget.initialize(selectedJson);
						}else{
							cateWidget.initialize();
						}
						var cancelBtn = new Button({
							label:" 取消 ",
							onClick:function(){
								closeDialog();
							}
						},"modelEditCancelBtn");
						var sureBtn = new Button({
							label:" 确定 ",
							onClick:function(){
								console.log(selectedData)
								var text = json["title"];
								if(selectedData["text"])
								{
									text = selectedData["text"];
								}
								var path = json["path"];
								if(selectedData["path"])
								{
									path = selectedData["path"];
								}
								switch(json["property"])
								{
									case "stylePath":
										properties["stylePath"] = path;
										break;
									case "roomPath":
										properties["roomPath"] = path;
										break;
									case "sightfeelingPath":
										properties["sightfeelingPath"] = path;
										break;
								}
								object.innerText = text;
								object.path = path;
								closeDialog();
							}
						},"modelEditSureBtn");
						
						dialog.on("hide",function(){
							closeDialog();
						});
						
						function closeDialog(){
							cancelBtn.destroy();
							sureBtn.destroy();
							cateWidget.destroy();
							dialog.destroy();
						}
						var selectedData = {};
						on(cateWidget, "onSelectedItemClick", function(res){
							selectedData = res;
						});
						dialog.show();
					}
					
					
					//根据参数名，获取值
					function getParameter(param){
						var value = "";
						var paramSearch = param+"=";
						var paramStr = location.search;
						var decode_paramStr = decodeURIComponent(paramStr).substring(1);
						var paramsArr = new Array();
						if(decode_paramStr.search(/&/)!=-1){
							paramsArr = decode_paramStr.split("&");
						}
						if(paramsArr[0]){
							arrayUtil.forEach(paramsArr,function(item,i){
								if(item.indexOf(param+"=")!=-1){
									value = item.substr(item.indexOf(param+"=")+paramSearch.length);
								}
							});
						}else{
							value = decode_paramStr.substr(decode_paramStr.indexOf(param+"=")+paramSearch.length);
						}
						return value;
						
					}
					
					var iframe = window.parent;
					if(iframe){
						this.hideAddItem = function(){
							iframe.hideDialog("dialogFromPreview");
							iframe.hideDialog("dialogAddModel");
						};
						this.hideDialogPreviewDetail = function(){
							iframe.hideDialog("dialogPreviewDetail");
							iframe.hideDialog("previewDetailDialog");
						};
					}
					
					var scene = window.parent.scene;
					var path = decodeURIComponent(window.location.href);
					var pathStrings = getParameter("path");
					
					var properties = {
						"stylePath" : "/content/modellibcategory/modelstyle",
						"madeOfPath" : "/content/modellibcategory/modelmadeof",
						"categoryPath" : "/content/modellibcategory/modelcategory",
						"brandPath" : "/content/modellibcategory/modelbrand",
						"roomPath" : "/content/modellibcategory/room",
						"sightfeelingPath" : "/content/modellibcategory/sightfeeling"
					};
					
					
					on(query("#_style_edit"), "click", function(){
						console.log("_style_edit");
						var json = {
							title1 : "选择风格",
							title : "请选择风格",
							path : "/content/modellibcategory/modelstyle",
							property : "stylePath"
						};
						newCategorySelectDialogAndShow.call(this, json);
					});
					on(query("#_madeOf_edit"), "click", function(){
						console.log("_madeOf_edit");
						var json = {
							title1 : "选择主材",
							title : "请选择主材",
							path : "/content/modellibcategory/modelmadeof",
							property : "madeOfPath"
						};
						newCategoryDialogAndShow.call(this, json);
					});
					on(query("#_category_edit"), "click", function(){
						console.log("_category_edit");
						var json = {
							title1 : "选择分类",
							title : "请选择分类",
							path : "/content/modellibcategory/modelcategory",
							property : "categoryPath"
						};
						newCategoryDialogAndShow.call(this, json);
					});
					on(query("#_brand_edit"), "click", function(){
						console.log("_brand_edit");
						var json = {
							title1 : "选择品牌",
							title : "请选择品牌",
							path : "/content/modellibcategory/modelbrand",
							property : "brandPath"
						};
						newCategoryDialogAndShow.call(this, json);
					});
					on(query("#_room_edit"), "click", function(){
						console.log("_room_edit");
						var json = {
							title1 : "选择居室类型",
							title : "请选择居室类型",
							path : "/content/modellibcategory/room",
							property : "roomPath"
						};
						newCategorySelectDialogAndShow.call(this, json);
					});
					on(query("#_sightfeeling_edit"), "click", function(){
						console.log("_sightfeeling_edit");
						var json = {
							title1 : "选择视觉感受",
							title : "请选择视觉感受",
							path : "/content/modellibcategory/sightfeeling",
							property : "sightfeelingPath"
						};
						newCategorySelectDialogAndShow.call(this, json);
					});
					on(query("#_save_btn_container"), "click", function(){
						console.log(typeof pathStrings);
						var newPathArray = pathStrings.split(",");
						
						// TODO 保存 API支持
						scene.setModelsPro({
							pathsArray : newPathArray,
							properties : properties,
							success : function(){
								Spolo.notify({
									"text" : "保存成功！",
									"type" : "success",
									"timeout" : 1000
								});
							},
							failed : function(){
								console.log("err");
							}
						})
						console.log("TODO 保存 API支持");
					});
					on(query("#_back_btn_container"), "click", function(){
						// TODO 取消
						console.log("TODO 保存 API支持");
					});
				}
			);
		</script>
	</body>
</html>