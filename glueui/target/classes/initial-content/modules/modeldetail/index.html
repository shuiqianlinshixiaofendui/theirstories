<!doctype html>  
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="description" content=""/>
		<meta name="keywords" content="" />
		<title></title>
	</head>
	
	<!-- 引入css布局 -->
	<link rel="stylesheet" type="text/css" href="./css/common.css" />
	<script>
		dojoConfig = {
			packages: [
				{
					name: "spolo",
					location: "/script/spolo"
				}
			]
		};
	</script>
	<!-- 加载js库 -->
	<script type="text/javascript" src="/libs/dojo/dojo.js"></script>
	<script type="text/javascript" src="/script/spolo.js"></script>
	<script type="text/javascript" src="/system/sling.js"></script>
	<script type="text/javascript" src="/libs/sling/explorer/js/jquery-1.4.2.min.js"></script>
	
	<!-- 添加事件处理 -->
	<script type="text/javascript">
		//调用data层方法
		require(["spolo/data/resource","dojo/dom","dojo/html","spolo/data/model","dojo/dom-style"],function(resource,dom,html,model,domStyle){
			//var resURL = Spolo.getCurrentNode();
			var resURL = "/users/admin/modellib/defaultCategory/chaji";
			//console.log("resURL   " + resURL);
			
			var resource = new resource(resURL);
			resource.getDetail(
				function(model){
					
					var type = resource.getType();
					console.log("type   " + type);
					
					//	1.获取并显示作者名称
					var Author = resource.getCreatedBy();
					//console.log("Author   " + Author);
					$('<em class="tb-author-string">' + Author +'</em>').appendTo("#J_StrAuthor");
					
					//	2.获取并显示用户名
					//var userName = resource.getUsername();
					var userName = "admin";
					//console.log("userName   " + userName);
					$('<em class="tb-userName-string">' + userName +'</em>').appendTo("#J_StruserName");
					
					//	3.获取并显示上传时间
					var CreatedDate = resource.getDate();
					//console.log("CreatedDate   " + CreatedDate);
					var year = CreatedDate.getFullYear();
					var month = CreatedDate.getMonth() + 1;
					var date = CreatedDate.getDate();
					var hours = CreatedDate.getHours();
					var min = CreatedDate.getMinutes();
					var sec = CreatedDate.getSeconds();
					var newdate = year + "-" + month + "-" + date + " " + hours + ":" + min + ":" + sec;
					$('<em class="tb-date-string">' + newdate +'</em>').appendTo("#J_StrDate");
					
					//	4.显示模型图片
					//$(function(){
						//var imgPath = model.getPreview();
						var imgPath = "/users/admin/modellib/defaultCategory/chaji/preview/chaji2.jpg";
						console.log("imgPath  " + imgPath);
						$("#J_ImgBooth").attr("src",imgPath);
					//});
					
					
					//	5.输入框 --- 事件处理 模型名称与模型价格
					$(function(){
						//显示原有信息
						/**	1.模型名称*/
						//1.TODO --- 首先需要获取模型当前的名称；
						var modelName = "茶几";
						//2.在编辑框中显示当前模型名称
						$("#modelName").attr("value",modelName);
						
						/**	2.模型价格*/
						//1.首先需要获取模型当前的价格；
						var modelPrice = model.getPrice();
						console.log("modelPrice " + modelPrice);
						//2.在编辑框中显示当前模型价格；
						$("#modelPrice").attr("value",modelPrice);
						
						$("input:text")
							//获得焦点
							.focus(function(){
								$(this).css("background","#CBFE9F");
							})
							//失去焦点
							.blur(function(){
								$(this).css("background","#FFF");
								var text = document.getElementById(this.id).value;
								//this.id == modelName 为模型名称； this.id == modelPrice 为模型价格
								if(this.id == "modelName"){
									var _modelName = text;
									//判断模型名称是否为空
									if(_modelName == ""){
										//在编辑框右侧进行文字提示 --- 模型名称不能为空
										dom.byId("modelName_prompt").innerHTML = "模型名称不能为空！！";
										domStyle.set("modelName_prompt","color","red");
										return;
									}else{
										//TODO --- 判断模型名称是否发生改变，对模型名称进行设置
										if(modelName != _modelName){
											//model.setName(modelName);
											dom.byId("modelName_prompt").innerHTML = "模型名称修改成功！！";
											domStyle.set("modelName_prompt","color","green");
										}
									}
								}else{
									if(text == ""){
										//在编辑框右侧进行文字提示 --- 模型价格不能为空
										dom.byId("modelPrice_prompt").innerHTML = "模型价格不能为空！！";
										domStyle.set("modelPrice_prompt","color","red");
										return;
									}else{
										if(!isNaN(text)){
											var _modelPrice = text;
											//TODO --- 判断模型价格是否发生改变，对模型价格进行设置
											if(modelPrice != _modelPrice){
												//设置模型价格
												console.log("_modelPrice  " + _modelPrice);
												model.setPrice(_modelPrice);
												dom.byId("modelPrice_prompt").innerHTML = "模型价格修改成功！！";
												domStyle.set("modelPrice_prompt","color","green");
											}
										}else{
											//在编辑框右侧进行文字提示--- 内容格式不对，请输入数值型
											dom.byId("modelPrice_prompt").innerHTML = "模型价格必须为数值型！！";
											domStyle.set("modelPrice_prompt","color","red");
											return;
										}
									}
								}
							})
							//按下回车键
							.keyup(function(event){
								if(event.keyCode == 13){
									//调用失去焦点方法
									$(this).blur();
								}
							})
					});
				},
				function(error){
					throw error;
				}
			);
		});
		//分类按钮 --- 事件处理
		function Model_sort(e){
			// Spolo.notify({
				// "text" : "模型属性分类！！！!",
				// "type" : "information",
				// "timeout" : 1000
			// });
		}
		//修改缩略图按钮 --- 事件处理
		function picChange(e){
			//获取选择的缩略图path
			//var picPath = model.getPreview();
			//console.log("picPath  " + picPath);
			var picPath = "./image/nopreview.jpg";
			//model.setPreview(picPath);
			$("#J_ImgBooth").attr("src",picPath);
			// Spolo.notify({
				// "text" : "修改缩略图！！！",
				// "type" : "information",
				// "timeout" : 1000
			// });
		}
		//一级材质上传按钮 --- 事件处理
		function A_material_upload(e){
			// Spolo.notify({
				// "text" : "一级材质上传！！！",
				// "type" : "information",
				// "timeout" : 1000
			// });
		}
		//选项卡 --- 事件处理
		$(function(){
			var tabContainers = $("div.main-wrap > div.main-wrap");
			$("#tab_1").attr("class","selected");
			$('div.main-wrap ul.tb-tabbar a').click(function () {
				$("#tab_1").removeClass("selected");
				tabContainers.hide();
				tabContainers.filter(this.hash).show();
				$('div.main-wrap ul.tb-tabbar a').removeClass('selected');
				$(this).addClass('selected');
				var currentTab = $(this).attr('href');
				var tabContainerId = currentTab.split('#')[1];
				var tabChildren = $("#attributes").children();
				for(var i=0; i<tabChildren.length; i++){
					if(tabChildren[i].id == tabContainerId){
						//设置其显示
						$("#" + tabChildren[i].id).css("display","block");
					}else{
						//设置隐藏
						$("#" + tabChildren[i].id).css("display","none");
					}
				}
				return false;
			});
		});
	</script>
	
	<body class="tb-new">
		<!-- 页面顶部的导航条 -->
		<div id="site-nav">
			<div id="site-nav-bd">
			</div>
		</div>
		<!-- 页面内容 -->
		<div id="page">
			<div id="content" class="eshop tb-shop " data-cat="J_Cat" >
				<p id="J_dcpg" class="design-page" style="display: none;"></p>
				<div id="bd">
					<div id="detail" class="mod-sku">
						<input type="hidden" value="" name="tb_token" id="J_TokenField" >
						<!-- 标题 -->
						<div class="tb-detail-hd">
							<h3>
								<span class="tb-double-tag"></span>
								模型属性编辑
							</h3>
							<p id="J_TEditItem"> </p>
						</div>
						<!-- 模型详细信息 -->
						<div class="tb-detail-bd tb-clear">
							<div class="tb-summary tb-clear">
								<!-- 左侧图片预览 & 修改缩略图按钮 -->
								<div class="tb-gallery">
									<div class="tb-booth tb-pic tb-s310">
										<img id="J_ImgBooth" src="" data-hasZoom="700" width="310" height="310"/>
									</div>
									<div id="J_isku" class="tb-key tb-key-sku">
										<div class="tb-skin tb-naked">
											<div id="picChange" onclick="picChange()" class="tb-btn-buy" style="margin-left:70px; background-image:url(./image/btn_bg.png);">
												<a href="#picChange" title="点击此按钮，修改并预览模型图片。">修改缩略图</a>
											</div>
										</div>
									</div>
								</div>
								<!-- 右侧模型详细信息 -->
								<div class="tb-property">
									<div class="tb-wrap tb-wrap-model" >
										<ul class="tb-meta">
											<li id="Author" class="tb-Author">
												<span>作　　者：</span>
												<strong id="J_StrAuthor" >
													<em class="tb-space">&nbsp;&nbsp;</em>
													<!-- <em class="tb-author-string"></em> -->
												</strong>
											</li>
											<div class="sep-line"></div>
											<div class="sep-line"></div>
											</br>
											<li id="userName" class="tb-userName">
												<span>用 户 名：</span>
												<strong id="J_StruserName" >
													<em class="tb-space">&nbsp;&nbsp;</em>
													<!-- <em class="tb-userName-string"></em> -->
												</strong>
											</li>
											<div class="sep-line"></div>
											<div class="sep-line"></div>
											</br>
											<li id="Model_sort" class="tb-Model-sort">
												<span>模型分类：</span>
												<em class="tb-space">&nbsp;</em>
												<div id="modelSort" onclick="Model_sort()" class="tb-btn-add" style="float:left; background-image:url(./image/btn_bg.png);">
													<a href="#modelSort" title="点击，可修改模型属性分类">模型属性分类</a>
												</div>
											</li>
											<div class="sep-line"></div>
											<div class="sep-line"></div>
											</br>
											<li id="Model_name" class="tb-Model-name">
												<span>模型名称：</span>
												<em class="tb-space">&nbsp;</em>
												<input type="text" name="modelName" id="modelName" value="">
												<label id="modelName_prompt"></label>
											</li>
											<div class="sep-line"></div>
											<div class="sep-line"></div>
											</br>
											<li id="Model_price" class="tb-Model-Price">
												<span>模型价格：</span>
												<em class="tb-space">&nbsp;</em>
												<input type="text" name="modelPrice" id="modelPrice" value="">
												<label id="modelPrice_prompt"></label>
											</li>
											<div class="sep-line"></div>
											<div class="sep-line"></div>
											</br>
											<li id="Model_upload_time" class="tb-Model-upload-time">
												<span>上传时间：</span>
												<strong id="J_StrDate" >
													<em class="tb-space">&nbsp;&nbsp;</em>
													<!-- <em class="tb-date-string">2012-12-10</em> -->
												</strong>
											</li>
											<div class="sep-line"></div>
											<div class="sep-line"></div>
											</br>
											<li id="Model_A_material" class="tb-Model-A_material">
												<span>一级材质：</span>
												<em class="tb-space">&nbsp;</em>
												<div class="tb-btn-add" id="material_upload" onclick="A_material_upload()" style="float:left; background-image:url(./image/btn_bg.png);">
													<a href="#material_upload" title="上传一级材质">一级材质上传</a>
												</div>
											</li>
											<div class="sep-line"></div>
											<div class="sep-line"></div>
										</ul>
									</div> 
								</div>
							</div>
						</div>
					</div>
					<!-- 选项卡 -->
					<div class="layout grid-s5m0 ">
						<div class="col-main clearfix">
							<div class="main-wrap J_TRegion" style="width:748px;">
								<!-- 选项卡标题 -->
								<div class="tb-tabbar-wrap" id="J_TabBarWrap" style="margin-left:-200px;">
									<ul class="tb-tabbar" id="J_TabBar">
										<li name="L1Material" id="tab_1">
											<a class="tb-tab-anchor" href="#attributes_matEdit" hidefocus="true" data-index="0">材质编辑</a>
										</li>
										<li name="downLoad" id="tab_2">
											<a class="tb-tab-anchor" href="#attributes_downLoad" hidefocus="true" data-index="1" >下载</a>
										</li>
									</ul>
								</div>
								<!-- 选项卡对应信息 -->
								<div id="attributes" class="attributes" style="margin-left:-200px; margin-top:9px; width:100%;">
									<div id="attributes_matEdit">
										<table width="100%">
											<tr id="title">
												<th>
													<font color="#039" size="3">贴图名称</font>
												</th>
												<th>
													<font color="#039" size="3">缩略图</font>
												</th>
												<th>
													<font color="#039" size="3">模型部件列表</font>
												</th>
												<th>
													<font color="#039" size="3">对应材质列表</font>
												</th>
											</tr>
										</table>
										<style>
											#page .m-item-list{padding-top:20px}
											#page .m-item-list li.mil-item{*display:inline;padding:14px 0 16px 15px;margin-bottom:-1px}
											#page .m-item-list li.mil-item .name-wrap{float:left;position:relative;width:240px;height:80px}
											#page .m-item-list li.mil-item .name-wrap .pic-name{height:36px;overflow:hidden;margin-left:15px;}
											#page .m-item-list li.mil-item .picbox{float:left;border:1px solid #e5e5e5;display:block;margin-left:-90px;margin-top:-15px;overflow:hidden;width:80px;height:80px;text-align:center;*font-size:72px;*font-family:arial}
											#page .m-item-list li.mil-item .picbox img{vertical-align:middle}
											#page .m-item-list li.mil-item .unit-wrap{line-height:20px;width:137px;overflow:hidden;float:left;margin-left:90px;}
											#page .m-item-list li.mil-item .unit-wrap .price-discount .unit{float:left;margin-right:8px;text-align:center;color:#fff;}
											#page .m-item-list li.mil-item .mat_list_group{float:right;width:183px;}
											#page .m-item-list li.mil-item .mat_list_group img{float:left;width:80px;height:90px;border:1px solid #000;margin-top:-20px;display:block;}
											#page .m-item-list li.mil-item .mat_list_group .mat_list_btn{float:left;width:100px;text-align:center;}
											#page .m-item-list li.mil-item .mat_list_group .mat_list_btn button{width:60px; height:30px;margin-top:10px;}
											#page .m-item-list{padding-top:15px}
										</style>
										<ul class="m-item-list m-item-list-790" data-spm="0.0.978" id="diffuse2">
											<li class="mil-item" id="mask1">
												<div class="name-wrap" name="picName">
													<div class="pic-name">
														<strong>k_008.jpg</strong>
													</div>
												</div>
												<a target="_blank" class="picbox" name="picThumbnail">
													<img alt="" src="./image/k_008.jpg" width="100%" height="100%">
												</a>
												<div class="unit-wrap" name="modelUnit">
													<div class="g_price unit g_price-highlight">
														<strong>水果</strong>
													</div>
												</div>
												<div class='mat_list_group'> 
													<img src=''/>
													<div class='mat_list_btn'>
														<div class='mat_list_text2'>空</div>
														<button type='button'>更换</button>
														<input type='hidden' class='L2matPath' value=''/>
													</div>
												</div>
												<div class="sep-line"></div>
												<div class="sep-line"></div>
												<hr align="center"/>
											</li>
											<li class="mil-item" id="mask2">
												<div class="name-wrap" name="picName">
													<div class="pic-name">
														<strong>k_008.jpg</strong>
													</div>
												</div>
												<a target="_blank" class="picbox" name="picThumbnail">
													<img alt="" src="./image/k_008.jpg" width="100%" height="100%">
												</a>
												<div class="unit-wrap" name="modelUnit">
													<div class="g_price unit g_price-highlight">
														<strong>电话</strong>
													</div>
												</div>
												<div class='mat_list_group'> 
													<img src=''/>
													<div class='mat_list_btn'>
														<div class='mat_list_text2'>空</div>
														<button type='button'>更换</button>
														<input type='hidden' class='L2matPath' value=''/>
													</div>
												</div>
												<div class="sep-line"></div>
												<div class="sep-line"></div>
												<hr align="center"/>
											</li>
											<li class="mil-item" id="mask3">
												<div class="name-wrap" name="picName">
													<div class="pic-name">
														<strong>k_008.jpg</strong>
													</div>
												</div>
												<a target="_blank" class="picbox" name="picThumbnail">
													<img alt="" src="./image/k_008.jpg" width="100%" height="100%">
												</a>
												<div class="unit-wrap" name="modelUnit">
													<div class="g_price unit g_price-highlight">
														<strong>书本封皮</strong>
													</div>
												</div>
												<div class='mat_list_group'> 
													<img src=''/>
													<div class='mat_list_btn'>
														<div class='mat_list_text2'>空</div>
														<button type='button'>更换</button>
														<input type='hidden' class='L2matPath' value=''/>
													</div>
												</div>
												<div class="sep-line"></div>
												<div class="sep-line"></div>
												<hr align="center"/>
											</li>
										</ul>
										<ul class="m-item-list m-item-list-790" data-spm="0.0.978" id="diffuse2">
											<li class="mil-item">
												<div class="name-wrap" name="picName">
													<div class="pic-name">
														<strong>k_001.jpg</strong>
													</div>
												</div>
												<a target="_blank" class="picbox" name="picThumbnail">
													<img alt="" src="./image/k_001.jpg" width="100%" height="100%">
												</a>
												<div class="unit-wrap" name="modelUnit">
													<div class="g_price unit g_price-highlight">
														<strong>桌面</strong>
													</div>
												</div>
												<div class='mat_list_group'> 
													<img src=''/>
													<div class='mat_list_btn'>
														<div class='mat_list_text2'>空</div>
														<button type='button'>更换</button>
														<input type='hidden' class='L2matPath' value=''/>
													</div>
												</div>
												<div class="sep-line"></div>
												<div class="sep-line"></div>
												<hr align="center"/>
											</li>
										</ul>
									</div>
									<div id="attributes_downLoad" style="display:none;">
										<style>
											#page .blockCp li{border-bottom:1px solid #dbdada; padding:15px; float:left}
											#page .blockCp .pic{width:58px; height:50px; float:left}
											#page .blockCp .pic img{width:32px; height:32px; padding:1px; border:1px solid #dfdfdf}
											#page .blockCp .meg{width:650px; float:right; line-height:24px; overflow:hidden;margin-left:50px;margin-top:-50px;}
											#page .blockCp .name{height:24px; line-height:24px; overflow:hidden; margin:0 0 2px; clear:both; border-bottom:1px dashed #d2d2d2}
											#page .blockCp .name .mark{font-size:14px; width:405px; overflow:hidden}
											#page .blockCp .name .mark strong{float:left; margin:0 5px 0 0;color:#039}
											#page .blockCp .fLeft{width:514px; float:left; line-height:22px}
											#page .blockCp .fRight{width:90px; float:right; text-align:center; padding:13px 0 0}
											#page .blockCp .des .tips{line-height:24px; height:24px; overflow:hidden;word-wrap:break-word}
											#page .blockCp .dlBtn{width:89px; height:23px; display:block; zoom:1; margin:0 0 5px; background:url(http://www1.pconline.com.cn/dl/2010/images/index.png) no-repeat 0 -21px}
											#page .blockCp li{padding:15px 15px 20px}
											#page .blockCp .fRight{width:115px}
											#page .blockCp .fRight i{display:block}
											#page .blockCp .dlBtn{background:url(http://www1.pconline.com.cn/2010/dl/add/images/dl.png) no-repeat -440px -131px;display:block;height:26px;margin:5px auto 0;width:92px;overflow:hidden;}
											#page .blockCp .dlBtn:hover{background:url(http://www1.pconline.com.cn/2010/dl/add/images/dl.png) no-repeat -532px -131px;}
											#page .blockCp .fLeft{word-wrap:break-word; overflow:hidden}
											#page .blockCp .blockCp .name .mark{width:390px}
											#page .blockCp .des,.blockCp .link{color:#666}
											#page .blockCp .link{clear:both;border-top:1px dashed #d2d2d2}
										</style>
										<ul class="blockCp">
											<li id="blender">
												<div class="pic">
													<img src="./image/blender.png" width="37" height="37" title="blender格式下载"/>
												</div>
												<div class="meg">
													<div class="name">
														<div class="mark">
															<strong>blender格式</strong>
														</div>
													</div>
													<div class="des">
														<div class="fLeft">
															<p class="tips">
																<em class="tit">提供者：</em>
																admin | 
																<em class="tit">文件大小：</em>
																17.58 MB | 
																<em class="tit">更新时间：</em>
																2005-05-31 | 
																<em class="tit">语言：</em>
																未知
															</p>
															<p>通过Blender创作出作品，再通过CC(Creative Commons）发布，所有人可以下载该作品或其源文件，用于修改后重新发布。......
																<!-- <a href="http://dl.pconline.com.cn/html_2/1/147/id=10161&pn=0.html" target="_blank" title="新概念英语学习软件">详细介绍>></a> -->
															</p>
														</div>
														<div class="fRight">
															<i>
																<a href="" target="_blank" class="dlBtn" title="blender格式下载"></a>
															</i>
														</div>
													</div>
												</div>
												<div class="clear"></div> 
											</li>
											<li id="x3d">
												<div class="pic">
													<img src="./image/icon.jpg" width="37" height="37" title="X3D格式下载"/>
												</div>
												<div class="meg">
													<div class="name">
														<div class="mark">
															<strong>X3D格式</strong>
														</div>
													</div>
													<div class="des">
														<div class="fLeft">
															<p class="tips">
																<em class="tit">提供者：</em>
																admin | 
																<em class="tit">文件大小：</em>
																17.58 MB | 
																<em class="tit">更新时间：</em>
																2005-05-31 | 
																<em class="tit">语言：</em>
																未知
															</p>
															<p>X3D格式文件...... 
																<!-- <a href="http://dl.pconline.com.cn/html_2/1/147/id=10161&pn=0.html" target="_blank" title="新概念英语学习软件">详细介绍>></a> -->
															</p>
														</div>
														<div class="fRight">
															<i>
																<a href="" target="_blank" class="dlBtn" title="X3D格式下载"></a>
															</i>
														</div>
													</div>
												</div>
												<div class="clear"></div> 
											</li>
										</ul>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>