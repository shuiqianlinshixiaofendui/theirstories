/** *  This file is part of the spp(Superpolo Platform). *  Copyright (C) by SanPolo Co.Ltd. *  All rights reserved. * *  See http://www.spolo.org/ for more information. * *  SanPolo Co.Ltd *  http://www.spolo.org/ *  Any copyright issues, please contact: copr@spolo.org**//**	当前node，表示摄像机lookat的位置。*/define("web3d/node_new/cameraAssisPoint",["dojo/topic"],function(topic){		// showHiddenBool判断当前摄像机表示点显示or隐藏。true显示 false隐藏		var showHiddenBool = true;		// 记录最后一次标志点位置				/**			cameraLookat_model 负责接收一个坐标。将模型移动到当前坐标下		*/		function cameraLookat_model (position){						var trans = document.getElementById("cameraLookatModule");			if(position){				trans.setAttribute("translation",position.x + " " + position.y + " " + position.z);			}					}				/**			根据参数，判断当前模型显示or隐藏		*/		function cameraLookat_model_display(){			var trans = document.getElementById("cameraLookatModule");			var material = trans.childNodes[0].childNodes[0].childNodes[0] ;			if(showHiddenBool){				material.setAttribute("transparency","0");			}else{				material.setAttribute("transparency","1");			}				}		/**			lookat 模型		*/		var module = function (x3d){			var viewarea = x3d.runtime.canvas.doc._viewarea;			var scene = viewarea._scene;			var transform = document.createElement('Transform');			transform.setAttribute("id","cameraLookatModule");			transform.setAttribute("scale","0.0005 0.0005 0.0005");			var shape = document.createElement('shape');			var appearance = document.createElement('appearance');			var material = document.createElement('material');			material.setAttribute("diffuseColor","red");			material.setAttribute("transparency","0");			var box = document.createElement('Sphere');						appearance.appendChild(material);			shape.appendChild(appearance);			shape.appendChild(box);			transform.appendChild(shape);			scene._xmlNode.appendChild(transform);											}				var cameraAssisPoint = dojo.declare([],{					// constructor 构造函数，负责接收一个摄像机lookat的初始位置			constructor : function (x3d){							module(x3d);								// 响应cameraOperate_mrs/cameraPosition事件，获取当前摄像机的lookat点				/*				topic.subscribe("cameraOperate_mrs/cameraPosition",function(position){					cameraLookat_model(position);				});				*/								// 响应快捷键事件，显示or隐藏当前摄像机盯着的模型				topic.subscribe("shortcut3d/showHidden",function(){										if(showHiddenBool){							showHiddenBool = false ;					}else{						showHiddenBool = true ;					}					cameraLookat_model_display();				});								var sync = Spolo.dataSync;				var data = sync.get_camera_data();				data.cameraAssisPoint = this;				sync.update_camera_data(data);							},						receivePos : function(position){				cameraLookat_model(position);			},						getPosition : function(){				var trans = document.getElementById("cameraLookatModule");				return trans._x3domNode._vf.translation;			}				});				return cameraAssisPoint;		});