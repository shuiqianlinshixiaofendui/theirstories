<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<title>图片预览</title>
        <link rel="stylesheet" type="text/css" href="css/demo.css" />
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<link rel="stylesheet" type="text/css" href="css/elastislide.css" />
		<noscript>
			<style>
				.es-carousel ul{
					display:block;
				}
			</style>
		</noscript>
		<script id="img-wrapper-tmpl" type="text/x-jquery-tmpl">	
			<div class="rg-image-wrapper">
				{{if itemsCount > 1}}
					<div class="rg-image-nav">
						<a href="#" class="rg-image-nav-prev">Previous Image</a>
						<a href="#" class="rg-image-nav-next">Next Image</a>
					</div>
				{{/if}}
				<div class="rg-image"></div>
				<div class="rg-loading"></div>
				<div class="rg-caption-wrapper">
					<div class="rg-caption" style="display:none;">
						<p></p>
					</div>
				</div>
			</div>
		</script>
    </head>
    <body>
		<div class="container">
			<div class="content">
				<div id="rg-gallery" class="rg-gallery">
					<div class="rg-thumbs">
						<!-- Elastislide Carousel Thumbnail Viewer -->
						<div class="es-carousel-wrapper">
							<div class="es-nav">
								<span class="es-nav-prev">Previous</span>
								<span class="es-nav-next">Next</span>
							</div>
							<div class="es-carousel">
								<ul>
								</ul>
							</div>
						</div>
						<!-- End Elastislide Carousel Thumbnail Viewer -->
					</div><!-- rg-thumbs -->
				</div><!-- rg-gallery -->
			</div><!-- content -->
		</div><!-- container -->
		<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
		<script type="text/javascript" src="/script/spolo.js"></script>
		<script type="text/javascript">
			/**
			* 初始化列表元素
			* 在使用gallery插件时，必须保证dom节点已经创建好了。
			* 所以需要先执行initItems方法来初始化列表项，静态数据可直接写入到列表中即可。
			*/
			
			function initItems(json){
				for(var i in json){
					var item = json[i];
					// 将数据格式化后，封装为jQuery对象。
					var $Node = $('<li><a href="#"><img onclick = ' + '"download(\''+item["smallImgSrc"]+'\')"' + ' src="'+item["smallImgSrc"]+'" data-large="'+item["bigImgSrc"]+'" alt="'+(item["imgName"] || "")+'" data-description="'+(item["name"] || "未命名")+'" /></a></li>');
					// is empty()
					if(!$(".es-carousel ul li").length)
					{
						download(item["smallImgSrc"]);
					}
					
					// 追加至列表中
					$(".es-carousel ul").append($Node);
				}
			}
			
			function download(url)
			{
				url = url.split(".image")[0] + ".download";
				// alert(this, " this");
				this.parent.spolo.priviewPath = url;
			}
			
			
			// 获取父框架传递参数
			var data = Spolo.getData("previewData");
			var json = {};
			for(var key in data){
				json[key] = {
					"name" : data[key]["resourceName"], // 名称或描述
					"smallImgSrc" : key+".image", // 小图路径
					"bigImgSrc" : key+".image",  // 大图路径
					"imgName" : data[key]["nodeName"] //图片名称，供图片的alt属性显示
				}
			}
			// 执行初始化列表数据
			initItems(json);
			
		</script>
		<script type="text/javascript" src="js/jquery.tmpl.min.js"></script>
		<script type="text/javascript" src="js/jquery.easing.1.3.js"></script>
		<script type="text/javascript" src="js/jquery.elastislide.js"></script>
		<script type="text/javascript" src="js/gallery.js"></script>
		<script type="text/javascript">
			// 如后续想再追加列表项，通过如下方法便可。$arg参数为jQuery对象
			//Gallery.addItems($arg);
		</script>
    </body>
</html>